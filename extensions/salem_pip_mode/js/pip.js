(function(){try{if(!("pictureInPictureEnabled"in document))return;const e="salem-pip-btn";let t=null,n=null;if(window.__salem_pip__)return;window.__salem_pip__=1;function i(e){if(!e)return!1;const t=getComputedStyle(e);if("none"===t.display||"hidden"===t.visibility||"0"===t.opacity)return!1;const n=e.getBoundingClientRect();return n.width>2&&n.height>2&&n.bottom>0&&n.right>0}function o(e){return Array.from(e.querySelectorAll("video"))}function r(){const e=[];for(const t of Array.from(document.querySelectorAll("iframe")))try{t.contentDocument&&e.push(...o(t.contentDocument))}catch(e){}return e}function a(){for(const e of["#movie_player video","ytd-player video","video[controls]:not([disablepictureinpicture])","video"]){const t=document.querySelector(e);if(t&&i(t))return t}let e=o(document).concat(r());return e.length?(e=e.filter(i),e.length||(e=o(document)),e.sort(((e,t)=>{const n=e.getBoundingClientRect(),i=t.getBoundingClientRect();return i.width*i.height-n.width*n.height})),e[0]||null):null}const d=function(){let t=document.getElementById(e);return t||(t=document.createElement("button"),t.id=e,t.type="button",t.textContent="â§‰",t.addEventListener("click",c,!1),(document.documentElement||document.body).appendChild(t)),t}();async function l(e){try{e.removeAttribute("disablepictureinpicture"),e.disablePictureInPicture=!1}catch(e){}try{e.setAttribute("playsinline","")}catch(e){}if(e.readyState<1)await new Promise((t=>e.addEventListener("loadedmetadata",t,{once:!0})));try{e.paused&&await e.play().catch((()=>{}))}catch(e){}}async function c(){try{const e=a();if(!e)return;document.pictureInPictureElement&&document.pictureInPictureElement!==e&&await document.exitPictureInPicture().catch((()=>{})),document.pictureInPictureElement===e?await document.exitPictureInPicture():(await l(e),await e.requestPictureInPicture())}catch(e){}u()}function u(){const e=a(),t=e&&document.pictureInPictureElement===e;d&&(d.setAttribute("data-active",t?"1":"0"),d.style.display=e?"inline-flex":"none"),e&&e!==t&&(t&&(t.removeEventListener("enterpictureinpicture",u),t.removeEventListener("leavepictureinpicture",u)),t=e,e.addEventListener("enterpictureinpicture",u),e.addEventListener("leavepictureinpicture",u))}function s(){const e=history.pushState,t=history.replaceState;history.pushState=function(){const t=e.apply(this,arguments);return queueMicrotask(u),t},history.replaceState=function(){const e=t.apply(this,arguments);return queueMicrotask(u),e},window.addEventListener("popstate",u)}function m(){if(n)return;const e=document.documentElement||document.body;e&&(n=new MutationObserver((()=>u())),n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["src","style","class","hidden"]}))}window.addEventListener("keydown",(e=>{(e.altKey||e.ctrlKey)&&!e.shiftKey&&!e.metaKey&&"KeyP"===e.code&&c()}),!0),window.addEventListener("message",(e=>{e&&"salem:pip:toggle"===e.data&&c()})),window.addEventListener("yt-navigate-finish",u),window.addEventListener("yt-page-data-updated",u),document.addEventListener("DOMContentLoaded",u,{once:!0}),window.addEventListener("load",u,{once:!0}),s(),m(),u()}catch(e){}})();